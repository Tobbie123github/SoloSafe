<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Login - SoloSafe</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">
   <link rel="stylesheet" type="text/css" href="https://cdn.jsdelivr.net/npm/toastify-js/src/toastify.min.css">
    <link rel="stylesheet" href="styles.css">
</head>

<body>
    <div class="auth-container">
        <div class="row g-0 h-100">
            <!-- LEFT SIDE - Login Form -->
            <div class="col-lg-6 auth-form-side order-2 order-lg-1">
                <div class="auth-form-container">
                    <div class="text-center mb-4">
                        <!-- <div class="logo-circle mx-auto mb-3">SS</div> -->
                        <img src="/images/logo-solo.jpg" width="25px" class="me-3" alt="logo-solo">
                        <!-- <h4 class="fw-bolder font-color pt-2">SoloSafe</h4> -->
                        <h2>Welcome Back</h2>
                        <p class="text-muted">Log in to continue your safe journey</p>
                    </div>

                    <form id="loginForm">
                        <!-- Email -->
                        <div class="mb-3">
                            <label for="email" class="form-label">Email Address</label>
                            <input type="email" class="form-control" id="email" placeholder="your.email@example.com"
                                required>
                            <div class="invalid-feedback" id="emailError"></div>
                        </div>

                        <!-- Password -->
                        <div class="mb-3">
                            <label for="password" class="form-label">Password</label>
                            <div class="input-group">
                                <input type="password" class="form-control" id="password"
                                    placeholder="Enter your password" required>
                                <button class="btn btn-outline-secondary" type="button" id="togglePassword">
                                    <i class="fas fa-eye"></i>
                                </button>
                            </div>
                            <div class="invalid-feedback" id="passwordError"></div>
                        </div>

                        <!-- Remember Me & Forgot Password -->
                        <div class="d-flex justify-content-between align-items-center mb-3">
                            <div class="form-check">
                                <input type="checkbox" class="form-check-input" id="remember">
                                <label class="form-check-label" for="remember">Remember me</label>
                            </div>
                            <a href="#" class="text-primary" data-bs-toggle="modal"
                                data-bs-target="#forgotPasswordModal">Forgot password?</a>
                        </div>

                        <!-- Submit Button -->
                        <button type="submit" class="btn btn-primary w-100 mb-3" id="loginBtn" disabled>Login</button>

                        <!-- Divider -->
                        <div class="divider">
                            <span>OR</span>
                        </div>

                        <!-- Google Login -->
                        <!-- <button type="button" class="btn btn-outline-secondary w-100 google-btn" id="googleLogin">
                            <img src="https://www.google.com/favicon.ico" alt="Google" class="google-icon">
                            Login with Google
                        </button> -->

                        <!-- Sign Up Link -->
                        <div class="text-center mt-4">
                            <p class="text-muted">Don't have an account? <a href="signup.html">Sign up</a></p>
                        </div>
                    </form>

                    <div class="text-center mt-3">
                        <a href="index.html" class="text-muted">‚Üê Back to home</a>
                    </div>
                </div>
            </div>

            <!-- RIGHT SIDE - Image Carousel -->
            <div class="col-lg-6 auth-image-side order-1 order-lg-2">
                <div class="carousel-overlay"></div>
                <div id="loginCarousel" class="carousel slide carousel-fade h-100" data-bs-ride="carousel">
                    <div class="carousel-inner h-100">
                        <div class="carousel-item active h-100">
                            <img src="https://images.unsplash.com/photo-1506905925346-21bda4d32df4?w=800"
                                class="d-block w-100 h-100 carousel-image" alt="Mountain">
                        </div>
                        <div class="carousel-item h-100">
                            <img src="https://images.unsplash.com/photo-1530789253388-582c481c54b0?w=800"
                                class="d-block w-100 h-100 carousel-image" alt="Travel">
                        </div>
                        <div class="carousel-item h-100">
                            <img src="https://images.unsplash.com/photo-1464207687429-7505649dae38?w=800"
                                class="d-block w-100 h-100 carousel-image" alt="Adventure">
                        </div>
                    </div>
                </div>
                <div class="carousel-text">
                    <h2>Travel Solo with Confidence</h2>
                    <p>Your safety companion for every adventure around the world</p>
                </div>
            </div>
        </div>
    </div>

    <!-- Forgot Password Modal -->
    <div class="modal fade" id="forgotPasswordModal" tabindex="-1">
        <div class="modal-dialog modal-dialog-centered">
            <div class="modal-content">
                <div class="modal-header">
                    <h5 class="modal-title">Reset Password</h5>
                    <button type="button" class="btn-close" data-bs-dismiss="modal"></button>
                </div>
                <div class="modal-body">
                    <p class="text-muted">Enter your email address and we'll send you a link to reset your password.</p>
                    <form id="forgotPasswordForm">
                        <div class="mb-3">
                            <label for="resetEmail" class="form-label">Email Address</label>
                            <input type="email" class="form-control" id="resetEmail" required>
                        </div>
                        <button type="submit" class="btn btn-primary w-100">Send Reset Link</button>
                    </form>
                </div>
            </div>
        </div>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/js/bootstrap.bundle.min.js"></script>
    <script type="text/javascript" src="https://cdn.jsdelivr.net/npm/toastify-js"></script>
    <script src="script.js"></script>
   
   
   <!--Mine -->

    
    
    

<script>

    const user = getCurrentUser();

        if (user) {
            window.location.href = 'dashboard.html';
        }
// Updated login script for SESSION-based authentication
const form = document.getElementById('loginForm');
const emailInput = document.getElementById('email');
const passwordInput = document.getElementById('password');
const loginBtn = document.getElementById('loginBtn');
const togglePasswordBtn = document.getElementById('togglePassword');
const googleLoginBtn = document.getElementById('googleLogin');
const forgotPasswordForm = document.getElementById('forgotPasswordForm');

// Enable login button when both fields have text
function checkFormValidity() {
    const isValid = emailInput.value.trim() !== '' &&
                    passwordInput.value.trim() !== '';
    loginBtn.disabled = !isValid;
}

// Add input listeners
emailInput.addEventListener('input', checkFormValidity);
passwordInput.addEventListener('input', checkFormValidity);

// Call once on load
checkFormValidity();

// Toggle password visibility
togglePasswordBtn.addEventListener('click', () => {
    const type = passwordInput.type === 'password' ? 'text' : 'password';
    passwordInput.type = type;
    togglePasswordBtn.querySelector('i').classList.toggle('fa-eye');
    togglePasswordBtn.querySelector('i').classList.toggle('fa-eye-slash');
});

// Handle form submission with SESSION auth
form.addEventListener('submit', async (e) => {
    e.preventDefault();

    const email = emailInput.value.trim();
    const password = passwordInput.value.trim();

    if (!email || !password) {
        showToast('Please fill in all fields', 'error');
        return;
    }

    loginBtn.disabled = true;
    loginBtn.innerText = 'Logging in...';

    try {
        const response = await fetch('https://solosafe-backend.onrender.com/api/auth/login', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
             
            body: JSON.stringify({ email, password })
        });

        console.log(response);

        const data = await response.json();

        console.log(data);

        if (!response.ok) {
            showToast(data.message || 'Invalid credentials', 'error');
            return;
        }

        // ‚úÖ For session auth, only store user data (no token)
        // The session cookie is automatically stored by the browser
        if (data) {
            localStorage.setItem('solosafe_user', JSON.stringify(data));
            showToast('Login successful üéâ', 'success');

            setTimeout(() => {
               window.location.href = '/dashboard.html';

            }, 1000);
        } else {
            showToast('Login failed - invalid response', 'error');
        }

    } catch (err) {
        console.error(err);
        showToast('Network error. Please try again.', 'error');
    } finally {
        loginBtn.disabled = false;
        loginBtn.innerText = 'Login';
    }
});

// Google OAuth Login
googleLoginBtn.addEventListener('click', () => {
    showToast('Redirecting to Google...', 'info');
    // Google OAuth will handle session creation automatically
    setTimeout(() => {
        window.location.href = 'https://solosafe-backend.onrender.com/api/auth/google';
    }, 1000);
});

// Forgot Password
forgotPasswordForm.addEventListener('submit', async (e) => {
    e.preventDefault();

    const resetEmail = document.getElementById('resetEmail').value.trim();
    
    try {
        await fetch('https://solosafe-backend.onrender.com/api/auth/forgot-password', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            credentials: 'include', // ‚úÖ Include credentials
            body: JSON.stringify({ email: resetEmail })
        });

        showToast('Password reset link sent to your email!', 'success');
        const modal = bootstrap.Modal.getInstance(document.getElementById('forgotPasswordModal'));
        modal.hide();
        forgotPasswordForm.reset();
    } catch (err) {
        console.error(err);
        showToast('Failed to send reset link', 'error');
    }
});

// Initialize carousel
const carousel = new bootstrap.Carousel(document.getElementById('loginCarousel'), {
    interval: 3000,
    ride: 'carousel'
});
</script>
</body>

</html>